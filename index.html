<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Powerhouze Group - Future PDC Growth Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 25%, #60a5fa 50%, #93c5fd 75%, #dbeafe 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .company-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .company-name {
            color: #1e40af;
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        
        .powerhouze-icon {
            font-size: 2.5rem;
            color: #fbbf24;
            filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.5));
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .header h1 {
            color: #1e40af;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .sync-status {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 600;
            border: 2px solid #fbbf24;
        }
        
        .sync-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #fbbf24;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .baseline-info {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin-top: 1.5rem;
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            text-align: center;
            border: 2px solid #fbbf24;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }
        
        .baseline-item {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        
        .baseline-value {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.3rem;
            color: #fbbf24;
        }
        
        .baseline-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        
        .card h3 {
            color: #1e40af;
            margin-bottom: 1.5rem;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .lightning-icon {
            color: #fbbf24;
            filter: drop-shadow(0 0 5px rgba(251, 191, 36, 0.5));
        }
        
        .upload-area {
            border: 3px dashed #3b82f6;
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(251, 191, 36, 0.05));
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .upload-area::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(251, 191, 36, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.3s ease;
            opacity: 0;
        }
        
        .upload-area:hover {
            border-color: #fbbf24;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(251, 191, 36, 0.1));
            transform: translateY(-2px);
        }
        
        .upload-area:hover::before {
            opacity: 1;
        }
        
        .upload-area.dragover {
            border-color: #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(59, 130, 246, 0.1));
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #3b82f6;
            margin-bottom: 1rem;
            filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.3));
        }
        
        .results-section {
            display: none;
            margin-top: 2rem;
        }
        
        .growth-matrix {
            overflow-x: auto;
            margin-bottom: 2rem;
        }
        
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #dbeafe;
        }
        
        .matrix-table th,
        .matrix-table td {
            padding: 1rem 0.8rem;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .matrix-table th {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            font-weight: 700;
            font-size: 0.95rem;
        }
        
        .matrix-table .date-cell {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1e40af;
            font-weight: 700;
        }
        
        .amount-cell {
            font-weight: bold;
            color: #1e40af;
            font-size: 1rem;
        }
        
        .growth-cell {
            font-size: 0.85rem;
            font-weight: 700;
            color: #059669;
        }
        
        .negative-growth {
            color: #dc2626;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin-top: 1rem;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 15px;
            border-left: 4px solid #fbbf24;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .metric:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 600;
        }
        
        .month-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .month-card {
            padding: 1.2rem;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 12px;
            text-align: center;
            border: 2px solid #dbeafe;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .month-card::before {
            content: 'âš¡';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.8rem;
            color: #fbbf24;
            opacity: 0.6;
        }
        
        .month-card:hover {
            transform: translateY(-3px);
            border-color: #fbbf24;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .month-name {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .month-current {
            font-size: 1.1rem;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 0.3rem;
        }
        
        .month-growth {
            font-size: 0.8rem;
            font-weight: 700;
        }
        
        .growth-positive {
            color: #059669;
        }
        
        .growth-negative {
            color: #dc2626;
        }
        
        .alert {
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            font-weight: 600;
            border: 2px solid;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
            border-color: #10b981;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            border-color: #3b82f6;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            border-color: #f59e0b;
        }
        
        .alert-error {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
            border-color: #dc2626;
        }
        
        .wide-card {
            grid-column: span 2;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        @media (max-width: 1200px) {
            .wide-card, .full-width {
                grid-column: span 1;
            }
        }
        
        .business-decision {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin-top: 1rem;
            border: 3px solid #fbbf24;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }
        
        .decision-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .powerhouze-branding {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 2px solid #fbbf24;
        }
        
        .welcome-message {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1e40af;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: bold;
            border: 3px solid #1e40af;
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.3);
            grid-column: 1 / -1;
        }
        
        .welcome-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .welcome-text {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 1rem;
            border: 2px solid #fbbf24;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="company-logo">
            <span class="powerhouze-icon">âš¡</span>
            <h1 class="company-name">The Powerhouze Group</h1>
            <span class="powerhouze-icon">âš¡</span>
        </div>
        <h1>Future PDC Growth Tracker</h1>
        <p style="color: #64748b; font-size: 1.1rem; font-weight: 500;">Powering Monthly Payment Arrangement Growth Analysis</p>
        
        <div class="sync-status" id="syncStatus">
            <div class="sync-indicator"></div>
            <span>Connected to Google Sheets</span>
            <button class="refresh-btn" onclick="loadGoogleSheetsData()">ðŸ”„ Refresh</button>
        </div>
        
        <div class="baseline-info" id="baselineInfo">
            <div class="baseline-item">
                <div class="baseline-value" id="baseSep">$0</div>
                <div class="baseline-label">Sep 2025</div>
            </div>
            <div class="baseline-item">
                <div class="baseline-value" id="baseOct">$0</div>
                <div class="baseline-label">Oct 2025</div>
            </div>
            <div class="baseline-item">
                <div class="baseline-value" id="baseNov">$0</div>
                <div class="baseline-label">Nov 2025</div>
            </div>
            <div class="baseline-item">
                <div class="baseline-value" id="baseDec">$0</div>
                <div class="baseline-label">Dec 2025</div>
            </div>
            <div class="baseline-item">
                <div class="baseline-value" id="baseJan">$0</div>
                <div class="baseline-label">Jan 2026</div>
            </div>
            <div class="baseline-item">
                <div class="baseline-value" id="baseFeb">$0</div>
                <div class="baseline-label">Feb 2026</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Welcome Message -->
        <div class="welcome-message" id="welcomeMessage">
            <div class="welcome-title">
                <span>âš¡</span>
                Welcome to The Powerhouze Growth Tracker
                <span>âš¡</span>
            </div>
            <div class="welcome-text">
                This dashboard is connected to your Google Sheets. Any manual updates you make to the sheet will automatically appear here.<br>
                You can also upload CSV files to add new data to your Google Sheet.
            </div>
        </div>

        <!-- Upload Section -->
        <div class="card">
            <h3><span class="lightning-icon">âš¡</span>Upload to Google Sheets</h3>
            <p style="color: #64748b; margin-bottom: 1rem;">Upload CSV data to automatically add new rows to your Google Sheet:</p>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">âš¡</div>
                <p style="color: #3b82f6; font-weight: 600; margin-bottom: 0.5rem;">
                    Drop your CSV file here or click to browse
                </p>
                <p style="color: #64748b; font-size: 0.9rem;">
                    Data will be added to your Google Sheet automatically
                </p>
                <input type="file" id="csvFile" accept=".csv" style="display: none;">
            </div>
            
            <div class="alert alert-info">
                <strong>âš¡ Debugging Info:</strong> Check browser console (F12) for detailed error messages if refresh doesn't work.
                <br><small>Google Sheets Integration: Your data is stored in Google Sheets and synced across all team members. Manual updates to the sheet will automatically appear here.</small>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="card">
            <h3><span class="lightning-icon">âš¡</span>How It Works</h3>
            <div style="margin-bottom: 1rem;">
                <h4 style="color: #1e40af; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.3rem;">
                    <span style="color: #fbbf24;">âš¡</span>Google Sheets Sync
                </h4>
                <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 1rem;">Dashboard automatically loads data from your Google Sheet and updates in real-time.</p>
                
                <h4 style="color: #1e40af; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.3rem;">
                    <span style="color: #fbbf24;">âš¡</span>CSV Upload
                </h4>
                <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 1rem;">Upload new CSV data to automatically add rows to your Google Sheet.</p>
                
                <h4 style="color: #1e40af; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.3rem;">
                    <span style="color: #fbbf24;">âš¡</span>Team Access
                </h4>
                <p style="color: #64748b; font-size: 0.9rem;">All team members see the same live data from the shared Google Sheet.</p>
            </div>
            
            <a href="https://docs.google.com/spreadsheets/d/1hZDXd2WkEky7JPjH1f0bdWoW5JGxWbpHJcH1JFj1MJY/edit" target="_blank" 
               style="background: #10b981; color: white; padding: 0.5rem 1rem; border-radius: 5px; text-decoration: none; font-weight: 600; display: inline-block;">
                ðŸ“Š Open Google Sheet
            </a>
        </div>
        
        <!-- Results Section -->
        <div class="results-section full-width" id="resultsSection">
            <!-- Growth Matrix -->
            <div class="card full-width">
                <h3><span class="lightning-icon">âš¡</span>Future Month Growth Matrix</h3>
                <div class="growth-matrix">
                    <table class="matrix-table" id="growthMatrix">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Sep 2025</th>
                                <th>Oct 2025</th>
                                <th>Nov 2025</th>
                                <th>Dec 2025</th>
                                <th>Jan 2026</th>
                                <th>Feb 2026</th>
                                <th>Total Pipeline</th>
                            </tr>
                        </thead>
                        <tbody id="matrixBody">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Pipeline Growth Chart -->
            <div class="card wide-card">
                <h3><span class="lightning-icon">âš¡</span>Future Pipeline Growth Trends</h3>
                <div class="chart-container">
                    <canvas id="pipelineChart"></canvas>
                </div>
            </div>
            
            <!-- Summary Metrics -->
            <div class="card">
                <h3><span class="lightning-icon">âš¡</span>Growth Summary</h3>
                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-value" id="totalGrowth">$0</div>
                        <div class="metric-label">Total Growth</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="weeklyAvg">$0</div>
                        <div class="metric-label">Weekly Average</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="growthRate">0%</div>
                        <div class="metric-label">Growth Rate</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="weekCount">0</div>
                        <div class="metric-label">Weeks Tracked</div>
                    </div>
                </div>
            </div>
            
            <!-- Individual Month Performance -->
            <div class="card">
                <h3><span class="lightning-icon">âš¡</span>Month-by-Month Performance</h3>
                <div class="month-cards" id="monthCards">
                    <!-- Month cards will be populated here -->
                </div>
            </div>
            
            <!-- Business Decision -->
            <div class="card full-width">
                <h3><span class="lightning-icon">âš¡</span>Powerhouze Strategy Recommendation</h3>
                <div id="businessDecision">
                    <div class="alert alert-info">
                        <strong>âš¡ Ready for Analysis:</strong> Data will load from your Google Sheet automatically.
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="powerhouze-branding">
        <span style="color: #fbbf24;">âš¡</span> Powered by The Powerhouze Group
    </div>

    <script>
        const GOOGLE_SHEETS_API_KEY = 'AIzaSyB4SVW9N1YRxIlDutd8p6Kzh5eyeDQrTaw';
        const SHEET_ID = '1hZDXd2WkEky7JPjH1f0bdWoW5JGxWbpHJcH1JFj1MJY';
        const RANGE = 'Sheet1!A:G'; // Date, Sep 2025, Oct 2025, Nov 2025, Dec 2025, Jan 2026, Feb 2026
        
        let chartInstance = null;
        
        // Load data from Google Sheets on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadGoogleSheetsData();
            
            // Auto-refresh every 2 minutes
            setInterval(loadGoogleSheetsData, 120000);
        });
        
        async function loadGoogleSheetsData() {
            try {
                document.getElementById('syncStatus').classList.add('loading');
                
                // Add detailed logging for debugging
                console.log('Attempting to fetch from Google Sheets...');
                console.log('API Key:', GOOGLE_SHEETS_API_KEY.substring(0, 10) + '...');
                console.log('Sheet ID:', SHEET_ID);
                console.log('Range:', RANGE);
                
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${GOOGLE_SHEETS_API_KEY}`;
                console.log('Full URL:', url);
                
                const response = await fetch(url);
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                console.log('Data received:', data);
                
                if (data.values && data.values.length > 1) {
                    // Convert to CSV-like format
                    const headers = data.values[0];
                    const rows = data.values.slice(1);
                    
                    console.log('Headers:', headers);
                    console.log('Rows:', rows);
                    
                    const csvData = rows.map(row => {
                        const obj = {};
                        headers.forEach((header, index) => {
                            obj[header] = row[index] || '';
                        });
                        return obj;
                    });
                    
                    console.log('Processed CSV data:', csvData);
                    
                    processData(csvData, false); // false = don't save to sheets
                    
                    updateSyncStatus('success', `Last updated: ${new Date().toLocaleTimeString()}`);
                } else {
                    console.log('No data found in response');
                    updateSyncStatus('warning', 'No data found in Google Sheet');
                }
                
            } catch (error) {
                console.error('Error loading Google Sheets data:', error);
                updateSyncStatus('error', `Connection error: ${error.message}`);
            } finally {
                document.getElementById('syncStatus').classList.remove('loading');
            }
        }
        
        async function appendToGoogleSheets(data) {
            try {
                // Convert data to array format
                const values = data.map(row => [
                    row.Date,
                    row['Sep 2025'],
                    row['Oct 2025'], 
                    row['Nov 2025'],
                    row['Dec 2025'],
                    row['Jan 2026'],
                    row['Feb 2026']
                ]);
                
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}:append?valueInputOption=USER_ENTERED&key=${GOOGLE_SHEETS_API_KEY}`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            values: values
                        })
                    }
                );
                
                if (!response.ok) {
                    throw new Error('Failed to append data to Google Sheets');
                }
                
                updateSyncStatus('success', 'Data uploaded to Google Sheets successfully!');
                
                // Reload data to show the update
                setTimeout(loadGoogleSheetsData, 1000);
                
            } catch (error) {
                console.error('Error appending to Google Sheets:', error);
                updateSyncStatus('error', 'Failed to upload to Google Sheets');
            }
        }
        
        function updateSyncStatus(type, message) {
            const status = document.getElementById('syncStatus');
            status.className = 'sync-status';
            
            if (type === 'success') {
                status.style.background = 'linear-gradient(135deg, #10b981, #059669)';
            } else if (type === 'warning') {
                status.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
            } else if (type === 'error') {
                status.style.background = 'linear-gradient(135deg, #dc2626, #b91c1c)';
            }
            
            status.innerHTML = `
                <div class="sync-indicator"></div>
                <span>${message}</span>
                <button class="refresh-btn" onclick="loadGoogleSheetsData()">ðŸ”„ Refresh</button>
            `;
        }
        
        // File upload handling
        const uploadArea = document.getElementById('uploadArea');
        const csvFile = document.getElementById('csvFile');
        
        uploadArea.addEventListener('click', () => csvFile.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        csvFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        function handleFile(file) {
            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                alert('Please upload a CSV file');
                return;
            }
            
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    // Filter and upload to Google Sheets
                    const cleanData = results.data.filter(row => row.Date && row['Sep 2025']);
                    if (cleanData.length > 0) {
                        appendToGoogleSheets(cleanData);
                    } else {
                        alert('No valid data found in CSV');
                    }
                }
            });
        }
        
        function processData(data, shouldUpload = false) {
            // Filter out empty rows
            const cleanData = data.filter(row => row.Date && row['Sep 2025']);
            
            if (cleanData.length < 1) {
                return;
            }
            
            // Parse amounts and remove $ and commas
            const processedData = cleanData.map(row => {
                const processedRow = { ...row };
                ['Sep 2025', 'Oct 2025', 'Nov 2025', 'Dec 2025', 'Jan 2026', 'Feb 2026'].forEach(month => {
                    if (processedRow[month]) {
                        processedRow[month] = parseFloat(processedRow[month].toString().replace(/[$,]/g, ''));
                    }
                });
                return processedRow;
            });
            
            // Update baseline display with first row
            if (processedData.length > 0) {
                const firstRow = processedData[0];
                document.getElementById('baseSep').textContent = '$' + (firstRow['Sep 2025'] || 0).toLocaleString();
                document.getElementById('baseOct').textContent = '$' + (firstRow['Oct 2025'] || 0).toLocaleString();
                document.getElementById('baseNov').textContent = '$' + (firstRow['Nov 2025'] || 0).toLocaleString();
                document.getElementById('baseDec').textContent = '$' + (firstRow['Dec 2025'] || 0).toLocaleString();
                document.getElementById('baseJan').textContent = '
                document.getElementById('baselineInfo').style.display = 'grid';
            }
            
            // Calculate growth matrix
            const growthMatrix = [];
            processedData.forEach((row, index) => {
                const matrixRow = {
                    date: row.Date,
                    months: {
                        'Sep 2025': row['Sep 2025'],
                        'Oct 2025': row['Oct 2025'],
                        'Nov 2025': row['Nov 2025'],
                        'Dec 2025': row['Dec 2025'],
                        'Jan 2026': row['Jan 2026'],
                        'Feb 2026': row['Feb 2026']
                    },
                    total: 0,
                    growth: {}
                };
                
                // Calculate total
                Object.values(matrixRow.months).forEach(amount => {
                    matrixRow.total += amount || 0;
                });
                
                // Calculate growth if not first row
                if (index > 0) {
                    Object.keys(matrixRow.months).forEach(month => {
                        const current = matrixRow.months[month] || 0;
                        const previous = processedData[index - 1][month] || 0;
                        matrixRow.growth[month] = current - previous;
                    });
                    matrixRow.totalGrowth = matrixRow.total - growthMatrix[index - 1].total;
                }
                
                growthMatrix.push(matrixRow);
            });
            
            // Update display
            updateGrowthMatrix(growthMatrix);
            updateSummaryMetrics(growthMatrix);
            updateMonthCards(growthMatrix);
            updateBusinessDecision(growthMatrix);
            updateChart(growthMatrix);
            
            // Show results
            document.getElementById('resultsSection').style.display = 'block';
            
            // Hide welcome message
            const welcomeMsg = document.getElementById('welcomeMessage');
            if (welcomeMsg && growthMatrix.length > 0) {
                welcomeMsg.style.display = 'none';
            }
        }
        
        function updateGrowthMatrix(data) {
            const tbody = document.getElementById('matrixBody');
            tbody.innerHTML = '';
            
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                
                // Date cell
                const dateCell = document.createElement('td');
                dateCell.className = 'date-cell';
                dateCell.textContent = row.date;
                tr.appendChild(dateCell);
                
                // Month cells
                Object.keys(row.months).forEach(month => {
                    const cell = document.createElement('td');
                    const amount = row.months[month];
                    const growth = row.growth[month];
                    
                    cell.innerHTML = `
                        <div class="amount-cell">$${amount ? amount.toLocaleString() : '0'}</div>
                        ${growth !== undefined ? `<div class="growth-cell ${growth >= 0 ? '' : 'negative-growth'}">${growth >= 0 ? '+' : ''}$${growth.toLocaleString()}</div>` : ''}
                    `;
                    tr.appendChild(cell);
                });
                
                // Total cell
                const totalCell = document.createElement('td');
                totalCell.innerHTML = `
                    <div class="amount-cell">$${row.total.toLocaleString()}</div>
                    ${row.totalGrowth !== undefined ? `<div class="growth-cell ${row.totalGrowth >= 0 ? '' : 'negative-growth'}">${row.totalGrowth >= 0 ? '+' : ''}$${row.totalGrowth.toLocaleString()}</div>` : ''}
                `;
                tr.appendChild(totalCell);
                
                tbody.appendChild(tr);
            });
        }
        
        function updateSummaryMetrics(data) {
            if (data.length < 2) {
                document.getElementById('totalGrowth').textContent = '$0';
                document.getElementById('weeklyAvg').textContent = '$0';
                document.getElementById('growthRate').textContent = '0%';
                document.getElementById('weekCount').textContent = data.length;
                return;
            }
            
            const firstTotal = data[0].total;
            const lastTotal = data[data.length - 1].total;
            const totalGrowth = lastTotal - firstTotal;
            const weekCount = data.length;
            const weeklyAvg = totalGrowth / (weekCount - 1);
            const growthRate = firstTotal > 0 ? ((lastTotal / firstTotal - 1) * 100) : 0;
            
            document.getElementById('totalGrowth').textContent = '$' + totalGrowth.toLocaleString();
            document.getElementById('weeklyAvg').textContent = '$' + Math.round(weeklyAvg).toLocaleString();
            document.getElementById('growthRate').textContent = growthRate.toFixed(1) + '%';
            document.getElementById('weekCount').textContent = weekCount;
        }
        
        function updateMonthCards(data) {
            const container = document.getElementById('monthCards');
            container.innerHTML = '';
            
            if (data.length < 1) return;
            
            const months = ['Sep 2025', 'Oct 2025', 'Nov 2025', 'Dec 2025', 'Jan 2026', 'Feb 2026'];
            const monthNames = ['September', 'October', 'November', 'December', 'January', 'February'];
            
            months.forEach((month, index) => {
                const firstAmount = data[0].months[month] || 0;
                const lastAmount = data[data.length - 1].months[month] || 0;
                const growth = lastAmount - firstAmount;
                const growthPercent = firstAmount > 0 ? ((growth / firstAmount) * 100) : 0;
                
                const card = document.createElement('div');
                card.className = 'month-card';
                card.innerHTML = `
                    <div class="month-name">${monthNames[index]}</div>
                    <div class="month-current">$${lastAmount.toLocaleString()}</div>
                    ${data.length > 1 ? `<div class="month-growth ${growth >= 0 ? 'growth-positive' : 'growth-negative'}">
                        ${growth >= 0 ? '+' : ''}$${growth.toLocaleString()} (${growthPercent.toFixed(1)}%)
                    </div>` : '<div class="month-growth" style="color: #64748b;">Baseline</div>'}
                `;
                container.appendChild(card);
            });
        }
        
        function updateBusinessDecision(data) {
            const container = document.getElementById('businessDecision');
            
            if (data.length < 2) {
                container.innerHTML = '<div class="alert alert-info"><span style="color: #fbbf24;">âš¡</span> Upload more data to your Google Sheet to receive business strategy recommendations.</div>';
                return;
            }
            
            const totalGrowth = data[data.length - 1].total - data[0].total;
            const positiveMonths = Object.keys(data[0].months).filter(month => {
                const growth = data[data.length - 1].months[month] - data[0].months[month];
                return growth > 0;
            }).length;
            
            let recommendation, alertClass, message;
            
            if (totalGrowth > 0 && positiveMonths >= 4) {
                recommendation = "âš¡ Continue $200 Monthly Payment Strategy";
                alertClass = "alert-success";
                message = `Powerhouze pipeline growth of $${totalGrowth.toLocaleString()} with ${positiveMonths}/6 future months growing. Monthly payment arrangements are building sustainable revenue.`;
            } else if (totalGrowth > 0 && positiveMonths >= 2) {
                recommendation = "âš¡ Monitor & Optimize Monthly Strategy";
                alertClass = "alert-warning";
                message = `Moderate growth of $${totalGrowth.toLocaleString()} with ${positiveMonths}/6 months growing. Consider optimizing payment terms and retention.`;
            } else {
                recommendation = "âš¡ Consider Hybrid Approach";
                alertClass = "alert-warning";
                message = `Limited pipeline growth. Consider combining monthly payments with lump sum settlements for better results.`;
            }
            
            container.innerHTML = `
                <div class="business-decision">
                    <div class="decision-title">${recommendation}</div>
                    <p>${message}</p>
                </div>
            `;
        }
        
        function updateChart(data) {
            const ctx = document.getElementById('pipelineChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            if (data.length < 1) return;
            
            const dates = data.map(row => row.date);
            const months = ['Sep 2025', 'Oct 2025', 'Nov 2025', 'Dec 2025', 'Jan 2026', 'Feb 2026'];
            const colors = ['#ef4444', '#f97316', '#fbbf24', '#22c55e', '#3b82f6', '#a855f7'];
            
            const datasets = months.map((month, index) => ({
                label: month.replace(' 2025', '').replace(' 2026', ' 2026'),
                data: data.map(row => row.months[month] || 0),
                borderColor: colors[index],
                backgroundColor: colors[index] + '20',
                borderWidth: 3,
                fill: false,
                tension: 0.4,
                pointBackgroundColor: colors[index],
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6
            }));
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html> + (firstRow['Jan 2026'] || 0).toLocaleString();
                document.getElementById('baseFeb').textContent = '
                document.getElementById('baselineInfo').style.display = 'grid';
            }
            
            // Calculate growth matrix
            const growthMatrix = [];
            processedData.forEach((row, index) => {
                const matrixRow = {
                    date: row.Date,
                    months: {
                        'Sep 2025': row['Sep 2025'],
                        'Oct 2025': row['Oct 2025'],
                        'Nov 2025': row['Nov 2025'],
                        'Dec 2025': row['Dec 2025'],
                        'Jan 2026': row['Jan 2026'],
                        'Feb 2026': row['Feb 2026']
                    },
                    total: 0,
                    growth: {}
                };
                
                // Calculate total
                Object.values(matrixRow.months).forEach(amount => {
                    matrixRow.total += amount || 0;
                });
                
                // Calculate growth if not first row
                if (index > 0) {
                    Object.keys(matrixRow.months).forEach(month => {
                        const current = matrixRow.months[month] || 0;
                        const previous = processedData[index - 1][month] || 0;
                        matrixRow.growth[month] = current - previous;
                    });
                    matrixRow.totalGrowth = matrixRow.total - growthMatrix[index - 1].total;
                }
                
                growthMatrix.push(matrixRow);
            });
            
            // Update display
            updateGrowthMatrix(growthMatrix);
            updateSummaryMetrics(growthMatrix);
            updateMonthCards(growthMatrix);
            updateBusinessDecision(growthMatrix);
            updateChart(growthMatrix);
            
            // Show results
            document.getElementById('resultsSection').style.display = 'block';
            
            // Hide welcome message
            const welcomeMsg = document.getElementById('welcomeMessage');
            if (welcomeMsg && growthMatrix.length > 0) {
                welcomeMsg.style.display = 'none';
            }
        }
        
        function updateGrowthMatrix(data) {
            const tbody = document.getElementById('matrixBody');
            tbody.innerHTML = '';
            
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                
                // Date cell
                const dateCell = document.createElement('td');
                dateCell.className = 'date-cell';
                dateCell.textContent = row.date;
                tr.appendChild(dateCell);
                
                // Month cells
                Object.keys(row.months).forEach(month => {
                    const cell = document.createElement('td');
                    const amount = row.months[month];
                    const growth = row.growth[month];
                    
                    cell.innerHTML = `
                        <div class="amount-cell">$${amount ? amount.toLocaleString() : '0'}</div>
                        ${growth !== undefined ? `<div class="growth-cell ${growth >= 0 ? '' : 'negative-growth'}">${growth >= 0 ? '+' : ''}$${growth.toLocaleString()}</div>` : ''}
                    `;
                    tr.appendChild(cell);
                });
                
                // Total cell
                const totalCell = document.createElement('td');
                totalCell.innerHTML = `
                    <div class="amount-cell">$${row.total.toLocaleString()}</div>
                    ${row.totalGrowth !== undefined ? `<div class="growth-cell ${row.totalGrowth >= 0 ? '' : 'negative-growth'}">${row.totalGrowth >= 0 ? '+' : ''}$${row.totalGrowth.toLocaleString()}</div>` : ''}
                `;
                tr.appendChild(totalCell);
                
                tbody.appendChild(tr);
            });
        }
        
        function updateSummaryMetrics(data) {
            if (data.length < 2) {
                document.getElementById('totalGrowth').textContent = '$0';
                document.getElementById('weeklyAvg').textContent = '$0';
                document.getElementById('growthRate').textContent = '0%';
                document.getElementById('weekCount').textContent = data.length;
                return;
            }
            
            const firstTotal = data[0].total;
            const lastTotal = data[data.length - 1].total;
            const totalGrowth = lastTotal - firstTotal;
            const weekCount = data.length;
            const weeklyAvg = totalGrowth / (weekCount - 1);
            const growthRate = firstTotal > 0 ? ((lastTotal / firstTotal - 1) * 100) : 0;
            
            document.getElementById('totalGrowth').textContent = '$' + totalGrowth.toLocaleString();
            document.getElementById('weeklyAvg').textContent = '$' + Math.round(weeklyAvg).toLocaleString();
            document.getElementById('growthRate').textContent = growthRate.toFixed(1) + '%';
            document.getElementById('weekCount').textContent = weekCount;
        }
        
        function updateMonthCards(data) {
            const container = document.getElementById('monthCards');
            container.innerHTML = '';
            
            if (data.length < 1) return;
            
            const months = ['Sep 2025', 'Oct 2025', 'Nov 2025', 'Dec 2025', 'Jan 2025', 'Feb 2025'];
            const monthNames = ['September', 'October', 'November', 'December', 'January', 'February'];
            
            months.forEach((month, index) => {
                const firstAmount = data[0].months[month] || 0;
                const lastAmount = data[data.length - 1].months[month] || 0;
                const growth = lastAmount - firstAmount;
                const growthPercent = firstAmount > 0 ? ((growth / firstAmount) * 100) : 0;
                
                const card = document.createElement('div');
                card.className = 'month-card';
                card.innerHTML = `
                    <div class="month-name">${monthNames[index]}</div>
                    <div class="month-current">$${lastAmount.toLocaleString()}</div>
                    ${data.length > 1 ? `<div class="month-growth ${growth >= 0 ? 'growth-positive' : 'growth-negative'}">
                        ${growth >= 0 ? '+' : ''}$${growth.toLocaleString()} (${growthPercent.toFixed(1)}%)
                    </div>` : '<div class="month-growth" style="color: #64748b;">Baseline</div>'}
                `;
                container.appendChild(card);
            });
        }
        
        function updateBusinessDecision(data) {
            const container = document.getElementById('businessDecision');
            
            if (data.length < 2) {
                container.innerHTML = '<div class="alert alert-info"><span style="color: #fbbf24;">âš¡</span> Upload more data to your Google Sheet to receive business strategy recommendations.</div>';
                return;
            }
            
            const totalGrowth = data[data.length - 1].total - data[0].total;
            const positiveMonths = Object.keys(data[0].months).filter(month => {
                const growth = data[data.length - 1].months[month] - data[0].months[month];
                return growth > 0;
            }).length;
            
            let recommendation, alertClass, message;
            
            if (totalGrowth > 0 && positiveMonths >= 4) {
                recommendation = "âš¡ Continue $200 Monthly Payment Strategy";
                alertClass = "alert-success";
                message = `Powerhouze pipeline growth of $${totalGrowth.toLocaleString()} with ${positiveMonths}/6 future months growing. Monthly payment arrangements are building sustainable revenue.`;
            } else if (totalGrowth > 0 && positiveMonths >= 2) {
                recommendation = "âš¡ Monitor & Optimize Monthly Strategy";
                alertClass = "alert-warning";
                message = `Moderate growth of $${totalGrowth.toLocaleString()} with ${positiveMonths}/6 months growing. Consider optimizing payment terms and retention.`;
            } else {
                recommendation = "âš¡ Consider Hybrid Approach";
                alertClass = "alert-warning";
                message = `Limited pipeline growth. Consider combining monthly payments with lump sum settlements for better results.`;
            }
            
            container.innerHTML = `
                <div class="business-decision">
                    <div class="decision-title">${recommendation}</div>
                    <p>${message}</p>
                </div>
            `;
        }
        
        function updateChart(data) {
            const ctx = document.getElementById('pipelineChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            if (data.length < 1) return;
            
            const dates = data.map(row => row.date);
            const months = ['Sep 2025', 'Oct 2025', 'Nov 2025', 'Dec 2025', 'Jan 2025', 'Feb 2025'];
            const colors = ['#ef4444', '#f97316', '#fbbf24', '#22c55e', '#3b82f6', '#a855f7'];
            
            const datasets = months.map((month, index) => ({
                label: month.replace(' 2025', '').replace(' 2025', ' 2026'),
                data: data.map(row => row.months[month] || 0),
                borderColor: colors[index],
                backgroundColor: colors[index] + '20',
                borderWidth: 3,
                fill: false,
                tension: 0.4,
                pointBackgroundColor: colors[index],
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6
            }));
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html> + (firstRow['Feb 2026'] || 0).toLocaleString();
                document.getElementById('baselineInfo').style.display = 'grid';
            }
            
            // Calculate growth matrix
            const growthMatrix = [];
            processedData.forEach((row, index) => {
                const matrixRow = {
                    date: row.Date,
                    months: {
                        'Sep 2025': row['Sep 2025'],
                        'Oct 2025': row['Oct 2025'],
                        'Nov 2025': row['Nov 2025'],
                        'Dec 2025': row['Dec 2025'],
                        'Jan 2026': row['Jan 2026'],
                        'Feb 2026': row['Feb 2026']
                    },
                    total: 0,
                    growth: {}
                };
                
                // Calculate total
                Object.values(matrixRow.months).forEach(amount => {
                    matrixRow.total += amount || 0;
                });
                
                // Calculate growth if not first row
                if (index > 0) {
                    Object.keys(matrixRow.months).forEach(month => {
                        const current = matrixRow.months[month] || 0;
                        const previous = processedData[index - 1][month] || 0;
                        matrixRow.growth[month] = current - previous;
                    });
                    matrixRow.totalGrowth = matrixRow.total - growthMatrix[index - 1].total;
                }
                
                growthMatrix.push(matrixRow);
            });
            
            // Update display
            updateGrowthMatrix(growthMatrix);
            updateSummaryMetrics(growthMatrix);
            updateMonthCards(growthMatrix);
            updateBusinessDecision(growthMatrix);
            updateChart(growthMatrix);
            
            // Show results
            document.getElementById('resultsSection').style.display = 'block';
            
            // Hide welcome message
            const welcomeMsg = document.getElementById('welcomeMessage');
            if (welcomeMsg && growthMatrix.length > 0) {
                welcomeMsg.style.display = 'none';
            }
        }
        
        function updateGrowthMatrix(data) {
            const tbody = document.getElementById('matrixBody');
            tbody.innerHTML = '';
            
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                
                // Date cell
                const dateCell = document.createElement('td');
                dateCell.className = 'date-cell';
                dateCell.textContent = row.date;
                tr.appendChild(dateCell);
                
                // Month cells
                Object.keys(row.months).forEach(month => {
                    const cell = document.createElement('td');
                    const amount = row.months[month];
                    const growth = row.growth[month];
                    
                    cell.innerHTML = `
                        <div class="amount-cell">$${amount ? amount.toLocaleString() : '0'}</div>
                        ${growth !== undefined ? `<div class="growth-cell ${growth >= 0 ? '' : 'negative-growth'}">${growth >= 0 ? '+' : ''}$${growth.toLocaleString()}</div>` : ''}
                    `;
                    tr.appendChild(cell);
                });
                
                // Total cell
                const totalCell = document.createElement('td');
                totalCell.innerHTML = `
                    <div class="amount-cell">$${row.total.toLocaleString()}</div>
                    ${row.totalGrowth !== undefined ? `<div class="growth-cell ${row.totalGrowth >= 0 ? '' : 'negative-growth'}">${row.totalGrowth >= 0 ? '+' : ''}$${row.totalGrowth.toLocaleString()}</div>` : ''}
                `;
                tr.appendChild(totalCell);
                
                tbody.appendChild(tr);
            });
        }
        
        function updateSummaryMetrics(data) {
            if (data.length < 2) {
                document.getElementById('totalGrowth').textContent = '$0';
                document.getElementById('weeklyAvg').textContent = '$0';
                document.getElementById('growthRate').textContent = '0%';
                document.getElementById('weekCount').textContent = data.length;
                return;
            }
            
            const firstTotal = data[0].total;
            const lastTotal = data[data.length - 1].total;
            const totalGrowth = lastTotal - firstTotal;
            const weekCount = data.length;
            const weeklyAvg = totalGrowth / (weekCount - 1);
            const growthRate = firstTotal > 0 ? ((lastTotal / firstTotal - 1) * 100) : 0;
            
            document.getElementById('totalGrowth').textContent = '$' + totalGrowth.toLocaleString();
            document.getElementById('weeklyAvg').textContent = '$' + Math.round(weeklyAvg).toLocaleString();
            document.getElementById('growthRate').textContent = growthRate.toFixed(1) + '%';
            document.getElementById('weekCount').textContent = weekCount;
        }
        
        function updateMonthCards(data) {
            const container = document.getElementById('monthCards');
            container.innerHTML = '';
            
            if (data.length < 1) return;
            
            const months = ['Sep 2025', 'Oct 2025', 'Nov 2025', 'Dec 2025', 'Jan 2025', 'Feb 2025'];
            const monthNames = ['September', 'October', 'November', 'December', 'January', 'February'];
            
            months.forEach((month, index) => {
                const firstAmount = data[0].months[month] || 0;
                const lastAmount = data[data.length - 1].months[month] || 0;
                const growth = lastAmount - firstAmount;
                const growthPercent = firstAmount > 0 ? ((growth / firstAmount) * 100) : 0;
                
                const card = document.createElement('div');
                card.className = 'month-card';
                card.innerHTML = `
                    <div class="month-name">${monthNames[index]}</div>
                    <div class="month-current">$${lastAmount.toLocaleString()}</div>
                    ${data.length > 1 ? `<div class="month-growth ${growth >= 0 ? 'growth-positive' : 'growth-negative'}">
                        ${growth >= 0 ? '+' : ''}$${growth.toLocaleString()} (${growthPercent.toFixed(1)}%)
                    </div>` : '<div class="month-growth" style="color: #64748b;">Baseline</div>'}
                `;
                container.appendChild(card);
            });
        }
        
        function updateBusinessDecision(data) {
            const container = document.getElementById('businessDecision');
            
            if (data.length < 2) {
                container.innerHTML = '<div class="alert alert-info"><span style="color: #fbbf24;">âš¡</span> Upload more data to your Google Sheet to receive business strategy recommendations.</div>';
                return;
            }
            
            const totalGrowth = data[data.length - 1].total - data[0].total;
            const positiveMonths = Object.keys(data[0].months).filter(month => {
                const growth = data[data.length - 1].months[month] - data[0].months[month];
                return growth > 0;
            }).length;
            
            let recommendation, alertClass, message;
            
            if (totalGrowth > 0 && positiveMonths >= 4) {
                recommendation = "âš¡ Continue $200 Monthly Payment Strategy";
                alertClass = "alert-success";
                message = `Powerhouze pipeline growth of $${totalGrowth.toLocaleString()} with ${positiveMonths}/6 future months growing. Monthly payment arrangements are building sustainable revenue.`;
            } else if (totalGrowth > 0 && positiveMonths >= 2) {
                recommendation = "âš¡ Monitor & Optimize Monthly Strategy";
                alertClass = "alert-warning";
                message = `Moderate growth of $${totalGrowth.toLocaleString()} with ${positiveMonths}/6 months growing. Consider optimizing payment terms and retention.`;
            } else {
                recommendation = "âš¡ Consider Hybrid Approach";
                alertClass = "alert-warning";
                message = `Limited pipeline growth. Consider combining monthly payments with lump sum settlements for better results.`;
            }
            
            container.innerHTML = `
                <div class="business-decision">
                    <div class="decision-title">${recommendation}</div>
                    <p>${message}</p>
                </div>
            `;
        }
        
        function updateChart(data) {
            const ctx = document.getElementById('pipelineChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            if (data.length < 1) return;
            
            const dates = data.map(row => row.date);
            const months = ['Sep 2025', 'Oct 2025', 'Nov 2025', 'Dec 2025', 'Jan 2025', 'Feb 2025'];
            const colors = ['#ef4444', '#f97316', '#fbbf24', '#22c55e', '#3b82f6', '#a855f7'];
            
            const datasets = months.map((month, index) => ({
                label: month.replace(' 2025', '').replace(' 2025', ' 2026'),
                data: data.map(row => row.months[month] || 0),
                borderColor: colors[index],
                backgroundColor: colors[index] + '20',
                borderWidth: 3,
                fill: false,
                tension: 0.4,
                pointBackgroundColor: colors[index],
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6
            }));
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
